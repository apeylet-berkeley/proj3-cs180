<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Part 3A & 3B — Warping, Mosaicing & Auto-Stitching (by antoine)</title>
  <style>
    :root{
      --bg: #0b0c0e; --paper: #111317; --text: #e9eef3; --muted: #aab7c5; --brand: #86b7ff;
      --card: #12161c; --ring: rgba(134,183,255,.35); --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px; --maxw: 1200px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f9fb; --paper:#ffffff; --text:#0f1720; --muted:#4b5563; --card:#ffffff; --shadow:0 8px 24px rgba(0,0,0,.08); }
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.55 system-ui,-apple-system, Segoe UI, Roboto, Helvetica, Arial}
    a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:var(--maxw);margin:auto;padding:28px 20px}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(to bottom, var(--bg), color-mix(in oklab, var(--bg) 80%, transparent));backdrop-filter: blur(8px);border-bottom:1px solid color-mix(in oklab, var(--text) 10%, transparent)}
    .hero{display:flex;flex-direction:column;gap:10px;padding:18px 0 14px}
    .title{font-weight:800;letter-spacing:.2px;font-size:clamp(26px, 2.6vw, 40px)}
    .subtitle{color:var(--muted)}
    nav.toc{display:flex;flex-wrap:wrap;gap:10px;margin:6px 0 2px}
    nav.toc a{padding:8px 12px;border:1px solid color-mix(in oklab,var(--text) 14%,transparent);border-radius:999px;background:color-mix(in oklab,var(--paper) 92%, transparent)}
    nav.toc a:hover{box-shadow:0 0 0 4px var(--ring)}
    main{padding-top:22px}
    section{scroll-margin-top:92px;margin:28px 0;padding:22px;border-radius:var(--radius);background:linear-gradient(to bottom right, color-mix(in oklab, var(--card) 96%, transparent), color-mix(in oklab, var(--card) 92%, transparent));box-shadow:var(--shadow);border:1px solid color-mix(in oklab,var(--text) 10%, transparent)}
    section h2{margin:0 0 10px;font-size:clamp(20px,2.1vw,28px)}
    .lead{color:var(--muted)}
    .grid{display:grid;gap:18px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 900px){ .grid.cols-2, .grid.cols-3{ grid-template-columns:1fr } }
    figure.card{margin:0;border-radius:14px;overflow:hidden;background:var(--paper);border:1px solid color-mix(in oklab,var(--text) 10%, transparent)}
    .imgwrap{aspect-ratio: 4/3; display:flex;align-items:center;justify-content:center;background:color-mix(in oklab,var(--paper) 70%, transparent)}
    img.media{width:100%;height:100%;object-fit:cover;display:block}
    figcaption{padding:10px 12px;color:var(--muted);font-size:14px}
    .note{border-left:4px solid var(--brand);padding:10px 12px;background:color-mix(in oklab,var(--paper) 94%, transparent);border-radius:10px;margin:10px 0}
    .kbd{font:12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:color-mix(in oklab,var(--text) 3%, transparent);padding:2px 6px;border-radius:6px;border:1px solid color-mix(in oklab,var(--text) 12%, transparent)}
    .matrix{background:var(--paper);border:1px dashed color-mix(in oklab,var(--text) 20%, transparent);padding:12px;border-radius:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:13px;overflow:auto}
    .row{display:flex;gap:16px;flex-wrap:wrap} .row > div{flex:1 1 260px}
    footer{color:var(--muted);padding:30px 0}
    .lb-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:50}
    .lb-overlay.active{display:flex}
    .lb-overlay img{max-width:min(95vw, 1400px);max-height:90vh;border-radius:12px;box-shadow:0 15px 40px rgba(0,0,0,.6)}
    .lb-close{position:fixed;top:16px;right:20px;color:white;font-size:28px;background:transparent;border:none;cursor:pointer}
    .lb-caption{position:fixed;bottom:22px;left:0;right:0;color:#eee;text-align:center;padding:8px 18px}
    .small{font-size:14px;color:var(--muted)}
    .tag{display:inline-block;background:color-mix(in oklab,var(--brand) 20%, transparent);color:color-mix(in oklab,var(--brand) 90%, white);padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid color-mix(in oklab,var(--brand) 60%, transparent)}
    .imgwrap.tall { aspect-ratio: auto; }
    .imgwrap.tall img.media { object-fit: contain; height: auto; }
  </style>
</head>
<body>
  <header>
    <div class="wrap hero">
      <div class="title">Part 3A &amp; 3B — Warping, Mosaicing &amp; Auto-Stitching <span class="small">(by antoine)</span></div>
      <p class="subtitle">Part 3A: manual homographies &amp; mosaics. Part 3B: Harris+ANMS, 8×8 descriptors, Lowe ratio matching, 4-point RANSAC, and automatic mosaics.</p>
      <nav class="toc" aria-label="Sections">
        <a href="#a1">A.1 Shoot the Pictures</a>
        <a href="#a2">A.2 Recover Homographies</a>
        <a href="#a3">A.3 Warp the Images</a>
        <a href="#a4">A.4 Blend into a Mosaic</a>
        <a href="#b1">B.1 Harris &amp; ANMS</a>
        <a href="#b2">B.2 Descriptors</a>
        <a href="#b3">B.3 Matching</a>
        <a href="#b4">B.4 RANSAC &amp; Mosaics</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- ---------- INTRO ---------- -->
    <section id="intro">
      <h2>Introduction</h2>
      <p class="lead">This page summarizes my implementation of Part 3A &amp; 3B. Part B builds upon A by adding automatic feature detection/matching and robust homographies for auto-stitching. All images below use filenames exported directly from my notebook to match the assignment’s deliverables.</p>
    </section>

    <!-- =============== PART A (as-is) =============== -->
    <!-- ---------- A1 ---------- -->
    <section id="a1">
      <h2>A.1 — Shoot the Pictures</h2>
      <div class="row">
        <div>
          <div class="note">
            <strong>Setup.</strong> I fix the center of projection and rotate the camera to capture overlapping views (≈40–70% overlap). I avoid strong lens distortion, shoot quickly to keep exposure consistent, and prefer static scenes with texture.
          </div>
          <ul>
            <li>Rotate in place (no translation) → projective relationship holds.</li>
            <li>Overlap ~40–70% ensures enough shared features.</li>
            <li>Lock exposure/focus when possible to minimize drift.</li>
            <li>Avoid fisheye; moderate/wide lenses are fine.</li>
          </ul>
        </div>
      </div>

      <h3 class="small">Image Sets</h3>
      <h4 class="small">Set 1 — Streetview</h4>
      <div class="grid cols-2">
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="assets/street_1.jpg" alt="Streetview — image 1"/></div>
          <figcaption>Set 1 — Streetview, image 1.</figcaption>
        </figure>
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="assets/street_2.jpg" alt="Streetview — image 2"/></div>
          <figcaption>Set 1 — Streetview, image 2.</figcaption>
        </figure>
      </div>

      <h4 class="small">Set 2 — Bedroom</h4>
      <div class="grid cols-2">
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="assets/bedroom_1.jpg" alt="Bedroom — image 1"/></div>
          <figcaption>Set 2 — Bedroom, image 1.</figcaption>
        </figure>
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="assets/bedroom_2.jpg" alt="Bedroom — image 2"/></div>
          <figcaption>Set 2 — Bedroom, image 2.</figcaption>
        </figure>
      </div>
      <p class="small">Tip: keep filenames organized by set; I used <span class="kbd">set1_img1.jpg</span>, <span class="kbd">set1_img2.jpg</span>, etc.</p>
    </section>

    <!-- ---------- A2 ---------- -->
    <section id="a2">
      <h2>A.2 — Recover Homographies</h2>
      <p>I estimate a homography <em>H</em> such that <code>p₂ ≃ H · p₁</code> using clicked correspondences. With <code>n ≥ 4</code> pairs (I recommend 6–10), I solve the normalized-DLT system…</p>

      <h3 class="small">Correspondence Views</h3>
      <figure class="card"><div class="imgwrap tall"><img class="media lb" src="assets/set1_corresp.jpg" alt="Set 1 correspondences"></div><figcaption>Set 1 — correspondences (full image).</figcaption></figure>
      <figure class="card"><div class="imgwrap tall"><img class="media lb" src="assets/set2_corresp.jpg" alt="Set 2 correspondences"></div><figcaption>Set 2 — correspondences (full image).</figcaption></figure>

      <div class="row" style="margin-top:14px">
        <div>
          <h4 class="small">Recovered H (Set 1)</h4>
          <pre class="matrix">H₁₂ = […]</pre>
        </div>
        <div>
          <h4 class="small">Recovered H (Set 2)</h4>
          <pre class="matrix">H₁₂ = […]</pre>
        </div>
      </div>
    </section>

    <!-- ---------- A3 ---------- -->
    <section id="a3">
      <h2>A.3 — Warp the Images (Inverse Mapping)</h2>
      <p>Inverse mapping warps the target pixel grid back into the source via <code>H⁻¹</code>…</p>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/poster.jpg" alt="Poster"></div><figcaption>Overlay: poster to insert.</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/wall.jpg" alt="Wall"></div><figcaption>Target wall (click TL→TR→BR→BL).</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/poster_in_panel.jpg" alt="Result"></div><figcaption>Result: poster embedded via <em>H</em>.</figcaption></figure>
      </div>
    </section>

    <!-- ---------- A4 ---------- -->
    <section id="a4">
      <h2>A.4 — Blend the Images into a Mosaic</h2>
      <h3 class="small">Set 1</h3>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set1_a.jpg" alt="Set 1 — A"></div><figcaption>Source A</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set1_b.jpg" alt="Set 1 — B"></div><figcaption>Source B</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set1_mosaic.jpg" alt="Set 1 mosaic"></div><figcaption>Mosaic (feathered blend)</figcaption></figure>
      </div>

      <h3 class="small">Set 2</h3>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set2_a.jpg" alt="Set 2 — A"></div><figcaption>Source A</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set2_b.jpg" alt="Set 2 — B"></div><figcaption>Source B</figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="assets/set2_mosaic.jpg" alt="Set 2 mosaic"></div><figcaption>Mosaic (feathered blend)</figcaption></figure>
      </div>
    </section>

    <!-- =============== PART B (added) =============== -->

    <!-- ---------- B1 ---------- -->
    <section id="b1">
      <h2>B.1 — Harris Corner Detection &amp; ANMS <span class="tag">Deliverable</span></h2>
      <p class="lead">Single-scale Harris (no sub-pixel), then Adaptive Non-Maximal Suppression. Below: corners overlaid <em>without</em> ANMS (NMS only) and <em>with</em> ANMS.</p>

      <h3 class="small">Image A</h3>
      <div class="grid cols-2">
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="A_corners_no_anms.png" alt="A corners without ANMS"></div>
          <figcaption>A — Harris corners (NMS only). File: <span class="kbd">A_corners_no_anms.png</span></figcaption>
        </figure>
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="A_corners_anms.png" alt="A corners with ANMS"></div>
          <figcaption>A — Harris corners (with ANMS). File: <span class="kbd">A_corners_anms.png</span></figcaption>
        </figure>
      </div>

      <h3 class="small">Image B</h3>
      <div class="grid cols-2">
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="B_corners_no_anms.png" alt="B corners without ANMS"></div>
          <figcaption>B — Harris corners (NMS only). File: <span class="kbd">B_corners_no_anms.png</span></figcaption>
        </figure>
        <figure class="card">
          <div class="imgwrap"><img class="media lb" src="B_corners_anms.png" alt="B corners with ANMS"></div>
          <figcaption>B — Harris corners (with ANMS). File: <span class="kbd">B_corners_anms.png</span></figcaption>
        </figure>
      </div>
    </section>

    <!-- ---------- B2 ---------- -->
    <section id="b2">
      <h2>B.2 — Feature Descriptor Extraction <span class="tag">Deliverable</span></h2>
      <p class="lead">Axis-aligned 8×8 descriptors sampled from a 40×40 window (blurred), with bias/gain normalization. Below are several sample descriptors (40×40 → blurred → 8×8).</p>

      <div class="grid cols-3">
        <!-- Use the saved figures produced by viz/export helper; examples shown -->
        <figure class="card"><div class="imgwrap"><img class="media lb" src="A_0_desc_0000.png" alt="A descriptor sample"></div><figcaption>A — descriptor sample #0 (40×40 → 8×8). File: <span class="kbd">A_0_desc_0000.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="A_1_desc_0001.png" alt="A descriptor sample"></div><figcaption>A — descriptor sample #1. File: <span class="kbd">A_1_desc_0001.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="A_2_desc_0002.png" alt="A descriptor sample"></div><figcaption>A — descriptor sample #2. File: <span class="kbd">A_2_desc_0002.png</span></figcaption></figure>
      </div>

      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="B_0_desc_0000.png" alt="B descriptor sample"></div><figcaption>B — descriptor sample #0. File: <span class="kbd">B_0_desc_0000.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="B_1_desc_0001.png" alt="B descriptor sample"></div><figcaption>B — descriptor sample #1. File: <span class="kbd">B_1_desc_0001.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="B_2_desc_0002.png" alt="B descriptor sample"></div><figcaption>B — descriptor sample #2. File: <span class="kbd">B_2_desc_0002.png</span></figcaption></figure>
      </div>
    </section>

    <!-- ---------- B3 ---------- -->
    <section id="b3">
      <h2>B.3 — Feature Matching (Lowe Ratio) <span class="tag">Deliverable</span></h2>
      <p class="lead">Matches between the two images using nearest / second-nearest distance ratio (Lowe). I also show the RANSAC inliers.</p>

      <div class="grid cols-2">
        <figure class="card">
          <div class="imgwrap tall"><img class="media lb" src="B3_matches_all.png" alt="All Lowe-ratio matches"></div>
          <figcaption>All matched features. File: <span class="kbd">B3_matches_all.png</span></figcaption>
        </figure>
        <figure class="card">
          <div class="imgwrap tall"><img class="media lb" src="B3_matches_inliers.png" alt="RANSAC inlier matches"></div>
          <figcaption>Geometrically consistent inliers (RANSAC). File: <span class="kbd">B3_matches_inliers.png</span></figcaption>
        </figure>
      </div>
    </section>

    <!-- ---------- B4 ---------- -->
    <section id="b4">
      <h2>B.4 — 4-Point RANSAC &amp; Automatic Mosaics <span class="tag">Deliverable</span></h2>
      <p class="lead">Homography via 4-point RANSAC (from scratch), mosaics via warping &amp; feathering. I compare Part A (manual) vs Part B (automatic) and show three different pairs.</p>

      <h3 class="small">Pair 1 — Manual vs Automatic</h3>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair1_manual.png" alt="Pair 1 manual mosaic"></div><figcaption>Manual stitch. File: <span class="kbd">pair1_manual.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair1_auto.png" alt="Pair 1 automatic mosaic"></div><figcaption>Automatic stitch. File: <span class="kbd">pair1_auto.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair1_manual_vs_auto.png" alt="Pair 1 side-by-side"></div><figcaption>Side-by-side. File: <span class="kbd">pair1_manual_vs_auto.png</span></figcaption></figure>
      </div>

      <h3 class="small">Pair 2 — Manual vs Automatic</h3>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair2_manual.png" alt="Pair 2 manual mosaic"></div><figcaption>Manual stitch. File: <span class="kbd">pair2_manual.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair2_auto.png" alt="Pair 2 automatic mosaic"></div><figcaption>Automatic stitch. File: <span class="kbd">pair2_auto.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair2_manual_vs_auto.png" alt="Pair 2 side-by-side"></div><figcaption>Side-by-side. File: <span class="kbd">pair2_manual_vs_auto.png</span></figcaption></figure>
      </div>

      <h3 class="small">Pair 3 — Manual vs Automatic</h3>
      <div class="grid cols-3">
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair3_manual.png" alt="Pair 3 manual mosaic"></div><figcaption>Manual stitch. File: <span class="kbd">pair3_manual.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair3_auto.png" alt="Pair 3 automatic mosaic"></div><figcaption>Automatic stitch. File: <span class="kbd">pair3_auto.png</span></figcaption></figure>
        <figure class="card"><div class="imgwrap"><img class="media lb" src="pair3_manual_vs_auto.png" alt="Pair 3 side-by-side"></div><figcaption>Side-by-side. File: <span class="kbd">pair3_manual_vs_auto.png</span></figcaption></figure>
      </div>

      <p class="small">Implementation notes: I use robust 4-point RANSAC (2000 iters default in the notebook), reprojection threshold 3–4 px, and a memory-friendly warper with fast feathering for large images.</p>
    </section>

    <footer>
      <p>© antoine — Part 3A/3B project page. Click any image to view full-size.</p>
    </footer>
  </main>

  <!-- Lightbox (vanilla JS) -->
  <div class="lb-overlay" id="lb" role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="lb-close" aria-label="Close" id="lbClose">×</button>
    <img id="lbImg" alt="" />
    <div class="lb-caption" id="lbCap"></div>
  </div>

  <script>
    const overlay = document.getElementById('lb');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    const lbClose = document.getElementById('lbClose');
    document.addEventListener('click', (e)=>{
      const img = e.target.closest('img.lb, img.media.lb, img.media');
      if(!img) return;
      lbImg.src = img.getAttribute('data-full') || img.src;
      const cap = img.closest('figure')?.querySelector('figcaption')?.textContent?.trim() || '';
      lbCap.textContent = cap;
      overlay.classList.add('active');
    });
    lbClose.addEventListener('click', ()=> overlay.classList.remove('active'));
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) overlay.classList.remove('active'); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') overlay.classList.remove('active'); });
  </script>
</body>
</html>
